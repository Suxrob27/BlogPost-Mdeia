@page
@model Bloggie.Web.Pages.Admin.NewFolder.Blog.AddModel
@{
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="bg-secondary">
    <h1>Add Blog Post</h1>
</div>
<div class="mx-auto p-2 text-center">
    <partial name="_NotificationPartial">

    <form method="post">
        <div class="form-floating mb-3">
            <input asp-for="blogModel.Heading" type="text" class="form-control" id="exampleInputEmail1">
            <label asp-for="blogModel.Heading" class="form-label">Heading</label>

        </div>
        <div class="form-floating mb-3">
            <input asp-for="blogModel.PageTitle"  type="text" class="form-control" id="exampleInputEmail1">
            <label asp-for="blogModel.PageTitle" class="form-label">Page Title</label>

        </div>
        <div class="form-floating mb-3">
            <textarea asp-for="blogModel.Content" class="form-control" style="height:100px"  id="content"></textarea>
        </div>
        <div class="form-floating mb-3">
            <input asp-for="blogModel.ShortDescription"  type="text" class="form-control" id="exampleInputEmail1">
            <label asp-for="blogModel.ShortDescription" class="form-label">Page Title</label>
        </div>

        <div class="form-floating mb-3">
            <input asp-for="FeaturedFile" type="text" id="featuredImageUpload" class="form-control" type="file">
            <img src="" id="featuredImageDisplay" style="display:none; width:300px;" />

        </div>

        <div class="form-floating mb-3">
            <input asp-for="blogModel.FeaturedImageUrl" type="text" class="form-control" >
            <label asp-for="blogModel.FeaturedImageUrl" id="featuredImageUrl" class="form-label">Featured Image Url</label>
        </div>
        <div class="form-floating mb-3">
            <input asp-for="blogModel.UrlHandle" type="text" class="form-control" id="exampleInputEmail1">
            <label asp-for="blogModel.UrlHandle" i class="form-label">Url Handle</label>
        </div>

        <div class="form-floating mb-3">
            <input asp-for="Tags" type="text" class="form-control" id="exampleInputEmail1">
            <label asp-for="Tags" i class="form-label">Tags (comma seperated)</label>
        </div>

        <div class="col-12">
            <div class="form-check text-start">
                <input asp-for="blogModel.Visible" class="form-check-input" type="checkbox" id="gridCheck">
                <label asp-for="blogModel.Visible" class="form-check-label" for="gridCheck">
                    Is Visible
                </label>
            </div>

        <button type="submit" class="btn btn-primary m-3">Submit</button>
    </form>
</div>

 @section Scripts 
 {
     <script>
        var editor = new FroalaEditor('#content', {
            imageUploadURL: '/api/ImageAPI'
        });


        const featuredImageUploadElement = document.getElementById('featuredImageUpload');
        const featuredImageUrl = document.getElementById('featuredImageUrl');
        const featuredImageDisplay = document.getElementById('featuredImageDisplay');


        async function uploadFeaturedImage(e) {
            console.log(e.target.files[0]);

            let data = new FormData();
            data.append('file', e.target.files[0]);

            await fetch('/api/ImageAPI', {
                method: 'POST',
                headers: {
                    'Accept': '*/*',
                },
                body: data
            }).then(response => response.json())
                .then(result => {
                    featuredImageUrl.value = result.link;
                    featuredImageDisplay.style.display = 'block';
                    featuredImageDisplay.src = result.link;
                });
        }

        featuredImageUploadElement.addEventListener('change', uploadFeaturedImage);

     </script>
 }